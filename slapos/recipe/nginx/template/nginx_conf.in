worker_processes %(nb_workers)s;

pid %(path_pid)s;
error_log %(path_error_log)s;
daemon off;

events {
  worker_connections 1024;
  accept_mutex off;
}

http {
  include mime.types;
  default_type application/octet-stream;
    access_log %(path_access_log)s combined;
  index %(index_page_id)s;

    server {
        listen [%(ip)s]:%(port)s;
        server_name _;

        keepalive_timeout 5;
        client_body_temp_path %(tmp)s/client_body_temp;
        proxy_temp_path %(tmp)s/proxy_temp;
        fastcgi_temp_path %(tmp)s/fastcgi_temp;
        uwsgi_temp_path %(tmp)s/uwsgi_temp;
        scgi_temp_path %(tmp)s/scgi_temp;

        # path for static files
        root %(root)s;

        location / {
                # This is cool because no php is touched for static content
                try_files $uri $uri/ /%(index_page_id)s;
        }

        location ~ \.php$ {
                #NOTE: You should have "cgi.fix_pathinfo = 0;" in php.ini
                fastcgi_pass %(php_cgi_address)s;
                fastcgi_param SCRIPT_FILENAME %(root)s/$fastcgi_script_name;

                # Copied from nginx/conf/fastcgi_params
                fastcgi_param  QUERY_STRING       $query_string;
                fastcgi_param  REQUEST_METHOD     $request_method;
                fastcgi_param  CONTENT_TYPE       $content_type;
                fastcgi_param  CONTENT_LENGTH     $content_length;
                
                fastcgi_param  SCRIPT_NAME        $fastcgi_script_name;
                fastcgi_param  REQUEST_URI        $request_uri;
                fastcgi_param  DOCUMENT_URI       $document_uri;
                fastcgi_param  DOCUMENT_ROOT      $document_root;
                fastcgi_param  SERVER_PROTOCOL    $server_protocol;
                
                fastcgi_param  GATEWAY_INTERFACE  CGI/1.1;
                fastcgi_param  SERVER_SOFTWARE    nginx/$nginx_version;
                
                fastcgi_param  REMOTE_ADDR        $remote_addr;
                fastcgi_param  REMOTE_PORT        $remote_port;
                fastcgi_param  SERVER_ADDR        $server_addr;
                fastcgi_param  SERVER_PORT        $server_port;
                fastcgi_param  SERVER_NAME        $server_name;

                # PHP only, required if PHP was built with --enable-force-cgi-redirect
                fastcgi_param  REDIRECT_STATUS    200;
        }

        location ~* \.(js|css|png|jpg|jpeg|gif|ico)$ {
                expires max;
                log_not_found off;
        }
    }
}
