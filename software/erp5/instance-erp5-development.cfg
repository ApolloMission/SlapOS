#############################
#
# Request erp5 development environnment
#
#############################
[buildout]

extends = ${template-zope:output}
parts +=
  request-mariadb
  request-cloudooo
  request-memcached
  request-kumofs
  basedirectory
  erp5-update

eggs-directory = ${buildout:eggs-directory}
develop-eggs-directory = ${buildout:develop-eggs-directory}
offline = true

[erp5-update]
recipe = slapos.cookbook:erp5.update

# Configuration
url = http://$${zope-instance:user}:$${zope-instances:password}@$${zope-instances:ip}:$${zope-instances:port}/
mysql-url = $${request-mariadb:connection-url}
kumofs-url = $${request-kumofs:connection-url}
memcached-url = $${request-memcached:connection-url}
cloudooo-url = $${request-cloudooo:connection-url}
site-id = $${slap-parameter:site-id}
openssl-binary = ${openssl:location}/bin/openssl
cadir-path = $${erp5-certificate-authority:ca-dir}

# Paths
update-wrapper = $${basedirectory:services}/erp5-update

# Defaults
configurator-bt5-list = erp5_core_proxy_field_legacy erp5_full_text_myisam_catalog erp5_base erp5_workflow erp5_configurator erp5_configurator_standard erp5_configurator_maxma_demo erp5_configurator_ung
bt5-repository-list = $${zope-instance:bt5-repository-list}
[request-common]
recipe = slapos.cookbook:request
software-url = $${slap-connection:software-release-url}
sla = computer_guid
sla-computer_guid = $${slap-connection:computer-id}
return = url
server-url = $${slap-connection:server-url}
key-file = $${slap-connection:key-file}
cert-file = $${slap-connection:cert-file}
computer-id = $${slap-connection:computer-id}
partition-id = $${slap-connection:partition-id}

[request-mariadb]
<=request-common
name = MariaDB DataBase
software-type = mariadb

[request-cloudooo]
<=request-common
name = Cloudooo
software-type = cloudooo

[request-memcached]
<=request-common
name = Memcached
software-type = memcached

[request-kumofs]
<=request-common
name = KumoFS
software-type = kumofs

# rest of parts are candidates for some generic stuff
[basedirectory]
recipe = slapos.cookbook:mkdirectory
services = $${rootdirectory:etc}/run/

[rootdirectory]
recipe = slapos.cookbook:mkdirectory
etc = $${buildout:directory}/etc/

