[buildout]

[publish-drupal-admin-password]
recipe = slapos.cookbook:publish
drupal-admin-password = $${drupal-init-base:admin-password}


[drupal-init-base]
recipe = slapos.cookbook:drupal_init
drush-binary = ${apache-php:location}/bin/drush
php-binary = ${apache-php:location}/bin/php
settings-php = ${application-configuration:location}
htdocs = $${rootdirectory:srv}/www
admin-password = $${gen-passwd:passwd}
dependency = $${apache-php:recipe}


#----------------
#--
#-- Generates a random password and stores it in the filesystem

[gen-passwd]
recipe = slapos.cookbook:generate.password
storage-path = $${rootdirectory:srv}/drupal_passwd
bytes = 16


[drupal-init]
recipe = cp.recipe.cmd
install_cmd =
   mkdir -m 700 ~/.ssh
   cp ${ssh-config:location}/ssh-config ~/.ssh/config
   $${drupal-init-base:drush-binary} make ${datapublic:location}/datapublic.make DrupalDataPublic

