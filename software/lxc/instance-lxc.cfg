[buildout]

eggs-directory = ${buildout:eggs-directory}
develop-eggs-directory = ${buildout:develop-eggs-directory}
offline = true

parts =
    slapcontainer
    rootfs
    publish
    slapcontainer-promise

[rootdirectory]
recipe = slapos.cookbook:mkdirectory
etc = $${buildout:directory}/etc
tmp = $${buildout:directory}/tmp

[basedirectory]
recipe = slapos.cookbook:mkdirectory
services = $${rootdirectory:etc}/run
promises = $${rootdirectory:etc}/promise

[slapcontainer]
recipe = slapos.cookbook:slapcontainer
ipv4 = $${slap-network-information:local-ipv4}
ipv6 = $${slap-network-information:global-ipv6}
interface = $${slap-network-information:network-interface}
config = $${buildout:directory}/.slapcontainer
lxc-config = $${buildout:directory}/config
archive = $${rootfs:downloaded-archive}
archive-complete = $${rootfs:downloaded-archive-complete}
tmp-dir = $${rootdirectory:tmp}/slapcontainer/
config-file = $${buildout:directory}/config
rootfs = $${buildout:directory}/rootfs
tar-binary = ${tar:location}/bin/tar
tar-path = ${tar:location}/bin:${gzip:location}/bin:${bzip2:location}/bin:${xz-utils:location}/bin

[slapcontainer-promise]
recipe = slapos.cookbook:slapcontainer.promise
promise = $${basedirectory:promises}/slapcontainer
lxc-info = ${lxc:location}/bin/lxc-info
slapcontainer-name = $${slapcontainer:slapcontainer-name}


[rootfs]
recipe = slapos.cookbook:rootfs
archive-url = $${slap-parameter:rootfs}
downloaded-archive = $${rootdirectory:tmp}/rootfs.tar.gz
downloaded-archive-complete = $${rootdirectory:tmp}/rootfs.ok
binary = $${basedirectory:services}/rootfsdownload
wget-binary = ${wget:location}/bin/wget

[publish]
recipe = slapos.cookbook:publish
ip = $${slap-network-information:global-ipv6}
