[buildout]
parts =
  instance
  publish-connection-parameter

eggs-directory = ${buildout:eggs-directory}
develop-eggs-directory = ${buildout:develop-eggs-directory}
offline = true

[slapconfiguration]
recipe = slapos.cookbook:slapconfiguration
computer = $${slap_connection:computer_id}
partition = $${slap_connection:partition_id}
url = $${slap_connection:server_url}
key = $${slap_connection:key_file}
cert = $${slap_connection:cert_file}

[instance-parameter]
port = 8888
host = $${slapconfiguration:ipv4-random}

[instance]
recipe = slapos.cookbook:wrapper
command-line = ${buildout:bin-directory}/ipython notebook --no-browser --matplotlib=inline --pylab --ip=$${instance-parameter:host} --port $${instance-parameter:port}
wrapper-path = $${directory:service}/ipython_notebook
parameters-extra = true

[directory]
recipe = slapos.cookbook:mkdirectory
home = $${buildout:directory}
etc = $${:home}/etc
var = $${:home}/var
script = $${:etc}/run/
service = $${:etc}/service
promise = $${:etc}/promise/
log = $${:var}/log

[publish-connection-parameter]
recipe = slapos.cookbook:publishurl
url = http://$${instance-parameter:host}:$${instance-parameter:port}

