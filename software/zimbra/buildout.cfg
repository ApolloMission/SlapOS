[buildout]

# XXX-Marco - Extra dependencies
# ------------------------------
# for libmemcached / opendkim:
# sudo apt-get install libcloog-ppl0
#

extends =
  /home/marco/src/slapos/stack/slapos.cfg
  /home/marco/src/slapos/component/git/buildout.cfg
  /home/marco/src/slapos/component/autoconf/buildout.cfg
  /home/marco/src/slapos/component/automake/buildout.cfg
  /home/marco/src/slapos/component/libtool/buildout.cfg
  /home/marco/src/slapos/component/bison/buildout.cfg
  /home/marco/src/slapos/component/flex/buildout.cfg
  /home/marco/src/slapos/component/unzip/buildout.cfg
  /home/marco/src/slapos/component/cmake/buildout.cfg
  /home/marco/src/slapos/component/ncurses/buildout.cfg
  /home/marco/src/slapos/component/bzip2/buildout.cfg
  /home/marco/src/slapos/component/pcre/buildout.cfg


parts =
  slapos-cookbook
  directories
  jdk
  ant
  autoconf
  automake
  libtool
  bison
  flex
  unzip
  cmake
  ncurses
  bzip2
  pcre
  zimbra-sources
  environment
  zimbra-build


develop =
  /home/marco/src/slapos

[versions]
slapos.cookbook =


[jdk-download]
# hack to download java bypassing javascript requirement
recipe = plone.recipe.command
location = ${directories:jdk_download}
web-dirname = 7u13-b20
filename = jdk-7u13-linux-x64.tar.gz
stop-on-error = True
update = true
command =
    wget --no-cookies --header "Cookie: gpw_e24=http%3A%2F%2Fwww.oracle.com" \
        "http://download.oracle.com/otn-pub/java/jdk/${:web-dirname}/${:filename}" \
        -O ${:location}/${:filename}

[jdk]
recipe = hexagonit.recipe.download
url = ${jdk-download:location}/${jdk-download:filename}
strip-top-level-dir = True


[ant]
recipe = hexagonit.recipe.download
url = http://mirrors.linsrv.net/apache//ant/binaries/${:filename}
filename = apache-ant-1.8.4-bin.tar.gz
md5sum = f5975145d90efbbafdcabece600f716b
strip-top-level-dir = True




[zimbra-sources]
recipe = slapos.recipe.build:gitclone
#repository = https://marco.mariani@bitbucket.org/marco.mariani/zimbra.git
repository = /home/marco/src/zimbra
branch = build2
develop = True
git-executable = ${git:location}/bin/git


[zimbra-build]
recipe = plone.recipe.command
command = ${zimbra-sources:location}/ZimbraBuild/buildZCS.sh -t --tpoverride
update-command = ${:command}
stop-on-error = True


[environment]
recipe = collective.recipe.environment
ZIMBRA_HOME = ${directories:zimbra_home}
JAVA_HOME = ${jdk:location}
ANT_HOME = ${ant:location}
PATH = /usr/local/bin:/usr/bin:/bin:${:JAVA_HOME}/bin:${:ANT_HOME}/bin:${autoconf:location}/bin:${automake:location}/bin:${libtool:location}/bin:${bison:location}/bin:${flex:location}/bin:${unzip:location}/bin:${cmake:location}/bin:${ncurses:location}/bin:${m4:location}/bin:${bzip2:location}/bin:${pcre:location}/bin
# another libtool is also built under ThirdParty
LIBTOOL_PREFIX = ${libtool:location}
BZIP2_PREFIX = ${bzip2:location}
PCRE_PREFIX = ${pcre:location}
#NCURSES_PREFIX = ${ncurses:location}
#CMAKE_PREFIX_PATH = ${ncurses:location}


[directories]
recipe = slapos.cookbook:mkdirectory
zimbra_home = ${buildout:directory}/zimbra_home
jdk_download = ${buildout:directory}/parts/jdk_download


# mysql FAILED.         (issue with ncurses)
# heimdal FAILED.       (issue with asn1-common.h)
# curl FAILED.          (Can't locate LWP/UserAgent.pm in @INC)
# cyrus-sasl FAILED.    (issue with libtoolize)
# openldap FAILED.      (depends on cyrus-sasl)
#* postfix FAILED.       (can't fidn pcre)
# dspam FAILED.         (depends on mysql)
#* nginx FAILED.         (depends on cyrus-sasl)
# opendkim FAILED.      (depends on openldap)

