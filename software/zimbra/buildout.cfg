[buildout]

# XXX-Marco - Extra dependencies
# ------------------------------
# for libmemcached / opendkim:
# sudo apt-get install libcloog-ppl0
# for heimdal:
# sudo apt-get install libncurses5-dev
#
# mysql will be compiled with the embedded yaSSL library instead of openssl
#

extends =
  /home/marco/src/slapos/stack/slapos.cfg
  /home/marco/src/slapos/component/git/buildout.cfg
  /home/marco/src/slapos/component/autoconf/buildout.cfg
  /home/marco/src/slapos/component/automake/buildout.cfg
  /home/marco/src/slapos/component/libtool/buildout.cfg
  /home/marco/src/slapos/component/bison/buildout.cfg
  /home/marco/src/slapos/component/flex/buildout.cfg
  /home/marco/src/slapos/component/unzip/buildout.cfg
  /home/marco/src/slapos/component/cmake/buildout.cfg
  /home/marco/src/slapos/component/ncurses/buildout.cfg
  /home/marco/src/slapos/component/bzip2/buildout.cfg
  /home/marco/src/slapos/component/pcre/buildout.cfg
  /home/marco/src/slapos/component/perl/buildout.cfg
  /home/marco/src/slapos/component/perl-libwww-perl/buildout.cfg
  /home/marco/src/slapos/component/perl-URI/buildout.cfg


parts =
  slapos-cookbook
  directories
  jdk
  ant
  autoconf
  automake
  libtool
  bison
  flex
  unzip
  cmake
  ncurses
  bzip2
  pcre
  perl
  perl-libwww-perl
  perl-URI
  zimbra-sources
  environment
  zimbra-build


develop =
  /home/marco/src/slapos

[versions]
slapos.cookbook =


[jdk-download]
# hack to download java bypassing javascript requirement
recipe = plone.recipe.command
location = ${buildout:parts-directory}/${:_buildout_section_name_}
web-dirname = 7u13-b20
filename = jdk-7u13-linux-x64.tar.gz
stop-on-error = True
update = true
command =
    mkdir -p ${:location}
    wget --no-cookies --header "Cookie: gpw_e24=http%3A%2F%2Fwww.oracle.com" \
        "http://download.oracle.com/otn-pub/java/jdk/${:web-dirname}/${:filename}" \
        -O ${:location}/${:filename}

[jdk]
recipe = hexagonit.recipe.download
url = ${jdk-download:location}/${jdk-download:filename}
strip-top-level-dir = True


[ant]
recipe = hexagonit.recipe.download
url = http://mirrors.linsrv.net/apache//ant/binaries/${:filename}
filename = apache-ant-1.8.4-bin.tar.gz
md5sum = f5975145d90efbbafdcabece600f716b
strip-top-level-dir = True




[zimbra-sources]
recipe = slapos.recipe.build:gitclone
#repository = https://marco.mariani@bitbucket.org/marco.mariani/zimbra.git
repository = /home/marco/src/zimbra
branch = build2
develop = True
git-executable = ${git:location}/bin/git


[zimbra-build]
recipe = plone.recipe.command
command = ${zimbra-sources:location}/ZimbraBuild/buildZCS.sh -t -p --tpoverride
update-command = ${:command}
stop-on-error = True


[environment]
recipe = slapos.cookbook:environment
ZIMBRA_HOME = ${directories:zimbra-home}
JAVA_HOME = ${jdk:location}
ANT_HOME = ${ant:location}
PATH = ${perl:location}/bin:/bin:${:JAVA_HOME}/bin:${:ANT_HOME}/bin:${autoconf:location}/bin:${automake:location}/bin:${libtool:location}/bin:${bison:location}/bin:${flex:location}/bin:${unzip:location}/bin:${cmake:location}/bin:${ncurses:location}/bin:${m4:location}/bin:${bzip2:location}/bin:${pcre:location}/bin:/usr/local/bin:/usr/bin
# another libtool is also built under ThirdParty
LIBTOOL_PREFIX = ${libtool:location}
BZIP2_PREFIX = ${bzip2:location}
PCRE_PREFIX = ${pcre:location}
NCURSES_PREFIX = ${ncurses:location}


[directories]
recipe = slapos.cookbook:mkdirectory
zimbra-home = ${buildout:directory}/zimbra-home


# cyrus-sasl FAILED.    (issue with libtoolize)
# openldap FAILED.      (depends on cyrus-sasl)
# postfix FAILED.       (depends on openldap)
# nginx FAILED.         (depends on cyrus-sasl)
# opendkim FAILED.      (depends on openldap)

