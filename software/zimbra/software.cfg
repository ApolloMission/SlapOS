[buildout]

extends =
  ../../stack/slapos.cfg
  ../../component/git/buildout.cfg

parts =
  slapos-cookbook
  directories
  environment
  jdk-download
  zimbra-sources

#  zimbra-build


[jdk-download]
recipe = plone.recipe.command
archive-location = ${directories:jdk_download}
web-dirname = 7u13-b20
filename = jdk-7u13-linux-x64.tar.gz
tar-dirname = jdk1.7.0_13
stop-on-error = True
update = true
command =
    wget --no-cookies --header "Cookie: gpw_e24=http%3A%2F%2Fwww.oracle.com" \
        "http://download.oracle.com/otn-pub/java/jdk/${:web-dirname}/${:filename}" \
        -O ${:archive-location}/jdk-7u13-linux-x64.tar.gz \
    && cd ${:archive-location} \
    && tar xfz ${:filename}


[zimbra-sources]
recipe = slapos.recipe.build:gitclone
#repository = https://marco.mariani@bitbucket.org/marco.mariani/zimbra.git
repository = /home/marco/src/zimbra
branch = build2
develop = True
git-executable = ${git:location}/bin/git


[zimbra-build]
recipe = plone.recipe.command
command = ${zimbra-sources:location}/ZimbraBuild/buildZCS.sh -t --tpoverride
update-command = ${:command}
stop-on-error = True
environment = 

[environment]
recipe = collective.recipe.environment
ZIMBRA_HOME = ${directories:zimbra_home}


[directories]
recipe = slapos.cookbook:mkdirectory
zimbra_home = ${buildout:directory}/zimbra_home
jdk_download = ${buildout:directory}/parts/jdk_download


