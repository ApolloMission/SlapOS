[buildout]
parts =
  slapos-instance

eggs-directory = ${buildout:eggs-directory}
develop-eggs-directory = ${buildout:develop-eggs-directory}
offline = true

[slapos-instance]
recipe = slapos.recipe.cmmi
# This url is useless
path = $${buildout:directory}
configure-command = msiexec.exe
configure-options =
  /i ${installer:location}/slapos-windows-all-in-one.exe
  TARGETDIR=$${buildout:directory}
  /quiet
  /log $${buildout:directory}/slapos-windows-installer.log
pre-install =
  cp ${installer:cygroot}/slapos-windows-wrapper.bat $${buildout:directory}/
  cp ${installer:cygroot}/cygwin/etc/opt/slapos/ssl/computer.key $${buildout:directory}/cygwin/
  cp ${installer:cygroot}/cygwin/etc/opt/slapos/ssl/computer.crt $${buildout:directory}/cygwin/
  cp ~/.slapos/key $${buildout:directory}/cygwin/
  cp ~/.slapos/certificate $${buildout:directory}/cygwin/
make-binary = true
post-install =
  $${buildout:directory}/slapos-windows-wrapper.bat slapos-configure slaproot
