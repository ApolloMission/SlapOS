[buildout]
parts =
  slapos-instance

eggs-directory = ${buildout:eggs-directory}
develop-eggs-directory = ${buildout:develop-eggs-directory}
offline = true

[slapos-instance]
recipe = slapos.recipe.cmmi
# This url is useless
path = $${buildout:directory}
configure-command = msiexec.exe
configure-options =
  /i ${installer:location}/slapos-windows-all-in-one.exe
  TARGETDIR=$${buildout:directory}
  /quiet
  /log $${buildout:directory}/slapos-windows-installer.log
pre-install =
  cp ${installer:cygroot}/slapos-windows-wrapper.bat $${buildout:directory}/
  cp ${installer:cygroot}/test-computer.key $${buildout:directory}/cygwin/computer.key
  cp ${installer:cygroot}/test-/computer.crt $${buildout:directory}/cygwin/computer.crt
  cp ~/.slapos/key $${buildout:directory}/cygwin/key
  cp ~/.slapos/certificate $${buildout:directory}/cygwin/certificate
make-binary = true
# The parameter "slaptester" is the password of slapos administrator
# passed to configure script
post-install =
  $${buildout:directory}/slapos-windows-wrapper.bat slapos-configure slaptester
