[buildout]

extends =
  ../../component/zabbix/buildout.cfg
  ../../stack/slapos.cfg
  ../../stack/lamp/buildout.cfg

parts +=
  slapos-cookbook
  zabbix-server
  apache-php
  instance-apache-php

[zabbix-instances]
recipe = slapos.recipe.template
url = ${:_profile_base_location_}/instance-zabbix.cfg.in
output = ${buildout:directory}/custom-apache-php.cfg
md5sum = 238b16283fa9a394ee8c0babdff3d470
mode = 0644

[custom-application-deployment]
path = ${zabbix-instances:output}
part-list = install-zabbix-db

[application]
recipe = plone.recipe.command
command = echo "I've already downloaded package"
update-command = 
location = ${zabbix-server:compile-directory}/zabbix-${zabbix-server:version}/frontends/php

[download-base]
recipe = slapos.recipe.download
location = ${buildout:parts-directory}/${:_buildout_section_name_}
mode = 0644
url = ${:_profile_base_location_}/${:filename}

[application-template]
<= download-base
md5sum = 918c54bf3696433414bb5384f294497c
filename = zabbix.conf.php.in

[template-zabbix-conf]
<= download-base
md5sum = 53daa6eb31ebf5c5a5406ee573f4f3f7
filename = zabbix_server.conf.in

[template-httpd-conf]
<= download-base
md5sum = e1b00a4b523439457dfb6d2a12c6436b
filename = apache.conf.in

[configure-dbscript]
<= download-base
md5sum = 9b1ecc1772e4f604e51b4f4532195846
filename = db.configure.py
url = ${:_profile_base_location_}/scripts/${:filename}

[zabbix-svcdeamon]
<= download-base
md5sum = 9aab8fd22cf296494f68fba78616d51d
url = ${:_profile_base_location_}/scripts/${:filename}
filename = svcdaemon.py

[application-configuration]
location = conf/zabbix.conf.php

