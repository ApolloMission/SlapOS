[buildout]
extends = template-runner.cfg
          ${pbsready-export:output}

parts +=
  nginx_conf
  nginx-launcher
  certificate-authority
  ca-nginx
  ca-shellinabox
  gunicorn-launcher
  gunicorn-graceful
  test-runner
  sshkeys-dropbear-runner
  dropbear-server-add-authorized-key
  sshkeys-authority
  publish-connection-informations
  slaprunner-promise
  slaprunner-frontend-promise
  dropbear-promise
  private
  shellinabox-promise
  symlinks
  shellinabox
  slapos-cfg
  slapos-repo-config
  cron-entry-backup
  cron-entry-prepare-software
  deploy-instance-parameters
###Parts to add for monitoring
  slap-parameters
  certificate-authority
  cron
  cron-entry-monitor
  cron-entry-rss
  deploy-index
  deploy-index-template
  deploy-monitor-script
  deploy-rss-script
  deploy-settings-cgi
  deploy-status-cgi
  make-rss
  monitor-frontend
  monitor-promise
  setup-static-files
  certificate-authority
  public
  zero-parameters
  cgi-httpd-wrapper
  public-symlink

[exporter]
recipe = slapos.cookbook:slaprunner.export
wrapper = $${directory:bin}/$${slap-parameter:namebase}-exporter
srv-directory = $${directory:srv}
etc-directory = $${directory:etc}
backup-directory = $${directory:backup}
shell-binary = ${dash:location}/bin/dash
rsync-binary = ${rsync:location}/bin/rsync

[monitor-promise]
url = $${monitor-frontend:config-url}/$${deploy-index:filename}

# Extends publish section with resilient parameters
[publish-connection-informations]
<= resilient-publish-connection-parameter
