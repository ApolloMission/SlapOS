[buildout]
extends =
  ../../component/dash/buildout.cfg
  ../../component/dcron/buildout.cfg
  ../../component/curl/buildout.cfg
  ../../component/gzip/buildout.cfg
  ../../component/logrotate/buildout.cfg
  ../../component/nginx/buildout.cfg
  ../../component/openssl/buildout.cfg
  ../../stack/slapos.cfg

parts =
  slapos-cookbook
  eggs
  instance-profile

[nginx-rtmp-module]
recipe = hexagonit.recipe.download
url = https://github.com/arut/nginx-rtmp-module/archive/748192877a98fea3088bcc6f9da5819de1b37663.zip
strip-top-level-dir = true

[nginx]
recipe = hexagonit.recipe.cmmi
url = http://nginx.org/download/nginx-1.4.3.tar.gz
md5sum = 4740dad2f0ed7f5fa16e8caaa8a9438e
configure-options=
  --with-ipv6
  --with-http_ssl_module
  --with-ld-opt="-L ${zlib:location}/lib -L ${openssl:location}/lib -L ${pcre:location}/lib  -Wl,-rpath=${pcre:location}/lib -Wl,-rpath=${zlib:location}/lib -Wl,-rpath=${openssl:location}/lib"
  --with-cc-opt="-I ${pcre:location}/include -I ${openssl:location}/include -I ${zlib:location}/include"
  --add-module=${nginx-rtmp-module:location}

[eggs]
recipe = zc.recipe.egg
eggs =
  slapos.toolbox
  collective.recipe.template



[instance-profile]
recipe = slapos.recipe.template
url = ${:_profile_base_location_}/instance.cfg.in
output = ${buildout:directory}/instance.cfg
#md5sum = 650cd2527158734fd6ccd9ec374b5e69
mode = 0644

[instance-streaming-profile]
recipe = hexagonit.recipe.download
url = ${:_profile_base_location_}/instance-streaming.cfg.jinja2
mode = 644
#md5sum = e16c15f72fdeb92ce1854bc25daf5ad7
download-only = true
on-update = true

[instance-streaming-frontend-profile]
recipe = slapos.recipe.template:jinja2
template = ${:_profile_base_location_}/instance-streaming-frontend.cfg.jinja2
rendered = ${buildout:directory}/template-streaming-frontend.cfg
extensions = jinja2.ext.do
context =
    key develop_eggs_directory buildout:develop-eggs-directory
    key eggs_directory buildout:eggs-directory
    raw nginx_conf_in ${nginx-frontend.conf.in:location}/nginx-frontend.conf.in
    raw nginx_executable_location ${nginx:location}/sbin/nginx
mode = 0644

[nginx.conf.in]
recipe = slapos.recipe.download
url = ${:_profile_base_location_}/template/${:_buildout_section_name_}
#md5sum = 7e41dfcb633ce52be42457ffd5b123d8
download-only = true
#filename = template.in
mode = 0644
location = ${buildout:parts-directory}/${:_buildout_section_name_}

[nginx-frontend.conf.in]
recipe = slapos.recipe.download
url = ${:_profile_base_location_}/template/${:_buildout_section_name_}
#md5sum = 7e41dfcb633ce52be42457ffd5b123d8
download-only = true
#filename = template.in
mode = 0644
location = ${buildout:parts-directory}/${:_buildout_section_name_}

[versions]
hexagonit.recipe.download = 1.7nxd002

