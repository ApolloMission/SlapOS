[buildout]
parts =
  directory

  publish-connection-parameter

eggs-directory = ${buildout:eggs-directory}
develop-eggs-directory = ${buildout:develop-eggs-directory}
offline = true


[instance-parameter]
recipe = slapos.cookbook:slapconfiguration
computer = $${slap_connection:computer_id}
partition = $${slap_connection:partition_id}
url = $${slap_connection:server_url}
key = $${slap_connection:key_file}
cert = $${slap_connection:cert_file}


[directory]
recipe = slapos.cookbook:mkdirectory
etc = $${buildout:directory}/etc
script = $${:etc}/run/
service = $${:etc}/service
promise = $${:etc}/promise/


# Create all postfix-related files
[postfix-master-cf]


# Create all postfix-related wrappers
[postfix-qmgr]
recipe = slapos.cookbook:wrapper
postfix-executable = ${postfix:location}/bin/postfix
command-line = $${:postfix-executable}
wrapper-path = $${directory:service}/qmgr

[postfix-master]
recipe = slapos.cookbook:wrapper
postfix-executable = ${postfix:location}/bin/postfix
command-line = $${:postfix-executable}
wrapper-path = $${directory:service}/master

[postfix-pickup]
recipe = slapos.cookbook:wrapper
postfix-executable = ${postfix:location}/bin/postfix
command-line = $${:postfix-executable}
wrapper-path = $${directory:service}/pickup


[publish-connection-parameter]
recipe = slapos.cookbook:publish
name = Hello $${instance-parameter:configuration.name}!
