[buildout]

extends = 
  ../../stack/slapos.cfg
  ../../component/git/buildout.cfg
  ../../component/gcc/buildout.cfg
  ../../component/libatlas/buildout.cfg
  ../../component/libblas/buildout.cfg



parts =
  eggs
  build-venv
  numpy-eggs

#  python2.7-virtualenv
#  gcc-fortran
#  libatlas
#  libblas



[build-venv]
recipe = cp.recipe.cmd
location = ${buildout:parts-directory}/${:_buildout_section_name_}
install_cmd =
  mkdir -p ${:location}
  cd ${:location}
  unset PYTHONPATH
  export PATH="${gcc-fortran:location}/bin:$PATH"
  export LD_PRELOAD="${gcc-fortran:location}/lib64/libgfortran.so.3 ${libblas:location}/libf77blas.so.3"
  export ATLAS=${libatlas:location}/lib/libsatlas.so
  export BLAS=${libblas:location}/lib/libfblas.a
  export LAPACK=${libatlas:location}/lib/liblapack.a
  ${python2.7-virtualenv:executable} ${:location}
  . ${:location}/bin/activate
  #pip install -U setuptools
  #pip install -U pip
  pip install numpy
  pip install Tempita
  export PYTHONPATH=/opt/slapgrid/72198f37425e64dd3f28648ea523da1d/eggs/numpy-1.8.1-py2.7-linux-x86_64.egg
  ${git:location}/bin/git clone https://github.com/mmariani/scipy.git -b hardcoded-numpy-location
  cd scipy
  python setupegg.py bdist_egg
  cd ..
  ${git:location}/bin/git clone https://github.com/scikit-learn/scikit-learn.git
  cd scikit-learn
  python setup.py bdist_egg
#update_cmd = ${:install_cmd}




[eggs]
recipe = zc.recipe.egg
eggs =
  ${lxml-python:egg}
  slapos.cookbook
  collective.recipe.template




[numpy-eggs]
recipe = zc.recipe.egg
find-links =
    ${buildout:parts-directory}/build-venv/scipy/dist
    ${buildout:parts-directory}/build-venv/scikit-learn/dist
eggs =
  xlrd
  xlwt
  flask
  pyparsing
  pydot
  numpy
  scipy
  scikit-learn
interpreter = python-numpy



[versions]
cp.recipe.cmd = 0.5nxd001
scipy = 0.13.3001
scikit-learn = 0.16-git


