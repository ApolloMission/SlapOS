[buildout]

extends = 
  ../../stack/slapos.cfg
  ../../component/git/buildout.cfg
  ../../component/gcc/buildout.cfg
  ../../component/libatlas/buildout.cfg
  ../../component/libblas/buildout.cfg
  ../../component/r-language/buildout.cfg


parts =
  python2.7-virtualenv
  eggs
  gcc-fortran
  libatlas
  libblas
  r-language
  sh-build-environment
  build-venv
  numpy-eggs

#  dream-venv
#  scipy-eggs







[build-venv]
recipe = cp.recipe.cmd
location = ${buildout:parts-directory}/${:_buildout_section_name_}
install_cmd =
  mkdir -p ${:location}
  cd ${:location}
  unset PYTHONPATH
  export PATH="${r-language:location}/bin:${gcc-fortran:location}/bin:$PATH"
  export LD_LIBRARY_PATH="`${r-language:location}/bin/R RHOME`/lib"
  export LD_PRELOAD="${gcc-fortran:location}/lib64/libgfortran.so.3 ${libblas:location}/libf77blas.so.3"
  export ATLAS=${libatlas:location}/lib/libsatlas.so
  export BLAS=${libblas:location}/lib/libfblas.a
  export LAPACK=${libatlas:location}/lib/liblapack.a
  ${python2.7-virtualenv:executable} ${:location}
  . ${:location}/bin/activate
  #pip install -U setuptools
  #pip install -U pip
  pip install numpy
  pip install Tempita
  export PYTHONPATH=/opt/slapgrid/72198f37425e64dd3f28648ea523da1d/eggs/numpy-1.8.1-py2.7-linux-x86_64.egg
  git clone https://github.com/mmariani/scipy.git -b hardcoded-numpy-location
  cd scipy
  python setupegg.py bdist_egg
  cd ..
  git clone https://github.com/scikit-learn/scikit-learn.git
  cd scikit-learn
  python setup.py bdist_egg
#update_cmd = ${:install_cmd}


#[dream-venv]
#recipe = cp.recipe.cmd
#location = ${buildout:parts-directory}/${:_buildout_section_name_}
#install_cmd =
#  mkdir -p ${:location}
#  cd ${:location}
#  unset PYTHONPATH
#  export PATH="${r-language:location}/bin:${gcc-fortran:location}/bin:$PATH"
#  export LD_LIBRARY_PATH="`${r-language:location}/bin/R RHOME`/lib"
#  export LD_PRELOAD="${gcc-fortran:location}/lib64/libgfortran.so.3 ${libblas:location}/libf77blas.so.3"
#  export ATLAS=${libatlas:location}/lib/libsatlas.so
#  export BLAS=${libblas:location}/lib/libfblas.a
#  export LAPACK=${libatlas:location}/lib/liblapack.a
#  ${python2.7-virtualenv:executable} ${:location}
#  . ${:location}/bin/activate
#  #pip install -U setuptools
#  #pip install -U pip
#  pip install numpy
#  pip install simpy==2.3
#  pip install scipy==0.13.3
#  pip install scikit-learn
#  pip install xlrd
#  pip install xlwt
#  pip install flask
#  pip install pyparsing==1.5.7
#  pip install pydot
#  # export LDFLAGS="-lncurses"
#  export PATH=${r-language:location}/bin:$PATH
#  # pip install rpy2
#  # clone repo for:
#  #   bug fix - https://bitbucket.org/lgautier/rpy2/issue/183
#  # (may switch to released egg later)
#  pip install mercurial
#  hg clone -b version_2.4.x_noreadline https://marco.mariani@bitbucket.org/marco.mariani/rpy2
#  cd rpy2
#  python setup.py install
#  cd ..
#  ${git:location}/bin/git clone http://git.erp5.org/repos/dream.git -b marco
#  cd dream
#  python setup.py install
#update_cmd = ${:install_cmd}






[eggs]
recipe = zc.recipe.egg
eggs =
  ${lxml-python:egg}
  slapos.cookbook
  collective.recipe.template




[numpy-eggs]
recipe = zc.recipe.egg
find-links =
    ${buildout:parts-directory}/build-venv/scipy/dist
    ${buildout:parts-directory}/build-venv/scikit-learn/dist
eggs =
  xlrd
  xlwt
  flask
  pyparsing
  pydot
  numpy
  scipy
  scikit-learn
interpreter = python-numpy



#[scipy-eggs]
#recipe = zc.recipe.egg:custom
#eggs =
#  scipy
#environment = build-environment


#[base-environment]
#recipe = collective.recipe.environment


#[build-environment]
#PYTHONPATH=
#PATH="${r-language:location}/bin:${gcc-fortran:location}/bin:${base-environment:PATH}"
#LD_LIBRARY_PATH="`${r-language:location}/bin/R RHOME`/lib"
#LD_PRELOAD="${gcc-fortran:location}/lib64/libgfortran.so.3 ${libblas:location}/libf77blas.so.3"
#ATLAS="${libatlas:location}/lib/libsatlas.so"
#BLAS="${libblas:location}/lib/libfblas.a"
#LAPACK="${libatlas:location}/lib/liblapack.a"


[sh-build-environment]
# environment needed for running/debugging the applications, exported to a shell script to be sourced.
recipe = collective.recipe.template
output = ${buildout:directory}/environment.sh
input = inline:
  unset PYTHONPATH
  export PATH="${r-language:location}/bin:${gcc-fortran:location}/bin:$PATH"
  export LD_LIBRARY_PATH="`${r-language:location}/bin/R RHOME`/lib"
  export LD_PRELOAD="${gcc-fortran:location}/lib64/libgfortran.so.3 ${libblas:location}/libf77blas.so.3"
  export ATLAS=${libatlas:location}/lib/libsatlas.so
  export BLAS=${libblas:location}/lib/libfblas.a
  export LAPACK=${libatlas:location}/lib/liblapack.a



[versions]
cp.recipe.cmd = 0.5nxd001
scipy = 0.13.3001
scikit-learn = 0.15-git
