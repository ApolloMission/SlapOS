[buildout]
parts =
  apache-php-postgres
  eggs
  template
  psycopg2
  template-apache-php
  template-postgres

extends =
  ../../component/apache/buildout.cfg
  ../../component/apache-php/buildout.cfg
  ../../component/dash/buildout.cfg
  ../../component/dcron/buildout.cfg
  ../../component/gzip/buildout.cfg
  ../../component/logrotate/buildout.cfg
  ../../component/lxml-python/buildout.cfg
  ../../component/postgresql/buildout.cfg
  ../../component/stunnel/buildout.cfg
  ../slapos.cfg


[eggs]
recipe = zc.recipe.egg
eggs =
  ${lxml-python:egg}
  ${psycopg2:egg}
  slapos.toolbox
  cns.recipe.symlink


#----------------
#-- Application-specific part (maarch, etc.)

[application]
recipe = hexagonit.recipe.download
strip-top-level-dir = true


#----------------
#-- Instance-level buildout profiles.

[template]
recipe = slapos.recipe.template
url = ${:_profile_base_location_}/instance.cfg
output = ${buildout:directory}/template.cfg
md5sum = fad4fe349039b9bac5f95322af1b8f5a
mode = 0644

[template-apache-php]
recipe = slapos.recipe.template
url = ${:_profile_base_location_}/apache/instance-apache-php.cfg.in
output = ${buildout:directory}/template-apache-php.cfg
md5sum = 6519eb4bb8a7e7b554fe482cc4c01c5b
mode = 0644

[template-postgres]
recipe = slapos.recipe.template
url = ${:_profile_base_location_}/postgres/instance-postgres.cfg.in
output = ${buildout:directory}/template-postgres.cfg
md5sum = ef659916da2ed5e5d886e07fac3c8ef4
mode = 0644


#----------------
#-- Dummy parts in case no application configuration file is needed

[application-template]
filename =
location =

[application-configuration]
location =


#----------------
#-- Postgres driver for Python recipes.

[psycopg2-env]
PATH = ${postgresql:location}/bin:%(PATH)s


[psycopg2]
recipe = zc.recipe.egg:custom
egg = psycopg2
define = PSYCOPG_EXTENSIONS,PSYCOPG_DISPLAY_SIZE,PSYCOPG_NEW_BOOLEAN,HAVE_PQFREEMEM,HAVE_PQPROTOCOL3
environment = psycopg2-env
include-dirs =
    ${postgresql:location}/include
library-dirs =
    ${postgresql:location}/lib
rpath = 
    ${postgresql:location}/lib


#----------------
#--
#-- Optional part allowing applications using this stack to run a custom
#-- instance.cfg at the end of Apache/PHP instance deployment.
#-- To use it in your application, just override those two parameters, like:

[custom-application-deployment]
# path = /path/to/instance-custom.cfg
# part-list = part1 part2
# See software/maarch/software.cfg for an example.
path =
part-list =

#----------------

