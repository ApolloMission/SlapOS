[buildout]
extends =
  ../component/python-2.6/buildout.cfg
  ../component/lxml-python/buildout.cfg
  ../component/git/buildout.cfg

extensions =
  slapos.tool.rebootstrap

parts =
  nbdserver
  pyOpenSSL-python
  eggs

find-links +=
  http://www.nexedi.org/static/packages/source/slapos.buildout/

versions = versions

[rebootstrap]
section = python2.6
version = 1

[nbdserver]
recipe = hexagonit.recipe.cmmi
path = ${nbdserversource:location}/
configure-options =
  --disable-system
  --disable-kvm
  --extra-cflags="-I${zlib:location}/include"
  --extra-ldflags="-L${zlib:location}/lib -Wl,-rpath -Wl,${zlib:location}/lib"
  --disable-werror

[nbdserversource]
recipe=plone.recipe.command
location = ${buildout:parts-directory}/${:_buildout_section_name_} 
stop-on-error = true
tag = slapos-v0.1
command =
  (${git:location}/bin/git clone --quiet --branch ipv6 git://gitorious.org/slapos/slapos-kvm.git ${:location} &&
  cd ${:location} && ${git:location}/bin/git pull --quiet origin tag ${:tag}) || (rm -fr ${:location} ; exit 1)
update-command =
  cd ${:location} && ${git:location}/bin/git pull --quiet origin tag ${:tag}

[eggs]
recipe = zc.recipe.egg
eggs =
  ${lxml-python:egg}
  slapos.recipe.nbdserver
  slapos.tool.onetimeupload
  pyOpenSSL

[pyOpenSSL-python]
recipe = zc.recipe.egg:custom
egg = pyOpenSSL
include-dirs =
  ${openssl:location}/include/ 
  ${python2.6:location}/include/ 
library-dirs =
  ${openssl:location}/lib/ 
  ${python2.6:location}/lib/ 
rpath =
  ${openssl:location}/lib/ 
  ${python2.6:location}/lib/ 


[versions]
zc.buildout = 1.5.3-dev-SlapOS-001
