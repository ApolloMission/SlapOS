[buildout]
extends = ${template-mariadb-pbsready:output}

parts += cron-entry-mariadb-backup

[mydumper]
recipe = slapos.cookbook:mydumper
wrapper = $${rootdirectory:bin}/raw_mydumper
backup-directory = $${directory:mariadb-backup}
socket = $${mariadb:socket}
user = root
mydumper-binary = ${mydumper:location}/bin/mydumper
database = $${mariadb:database}
import = false

[mydumper-locked]
recipe = slapos.cookbook:lockfile
lock-file = $${basedirectory:run}/mysql-backup.lock
binary = $${mydumper:wrapper}
wrapper = $${rootdirectory:bin}/mydumper

[cron-entry-mariadb-backup]
<= cron
recipe = slapos.cookbook:cron.d
name = backup
frequency = 0 * * * *
command = $${mydumper-locked:wrapper}
