[buildout]
extensions =
  slapos.rebootstrap
  slapos.zcbworkarounds
  buildout-versions

find-links = 
    http://www.nexedi.org/static/packages/source/slapos.buildout/
    http://dist.repoze.org
    http://www.nexedi.org/static/packages/source/
    http://www.owlfish.com/software/wsgiutils/download.html

extends =
  ../component/libreoffice-bin/buildout.cfg 
  ../component/libpng/buildout.cfg
  ../component/lxml-python/buildout.cfg
  ../component/python-2.6/buildout.cfg
  ../component/python-2.7/buildout.cfg
  ../component/xorg/buildout.cfg
  ../component/fonts/buildout.cfg
  ../component/git/buildout.cfg
  ../component/poppler/buildout.cfg
  ../component/imagemagick/buildout.cfg
  ../component/pdftk/buildout.cfg
  ../component/xpdf/buildout.cfg
  ../component/ffmpeg/buildout.cfg
  ../component/file/buildout.cfg
  ../component/stunnel/buildout.cfg
  ../component/rdiff-backup/buildout.cfg
  ../component/dcron/buildout.cfg
  ../component/coreutils/buildout.cfg
 
versions = versions

parts =
  libreoffice-bin
  stunnel
  dcron
  
# basic Xorg
  libXdmcp
  libXext
  libXau
  libSM
  libXrender

# fonts
  liberation-fonts
  ipaex-fonts

# Dependencies
  libpng12
  imagemagick
  file
  poppler
  xpdf
  pdftk
  ffmpeg

  bootstrap2.6
  rdiff-backup
  cloudooo
  cloudooo-check-recipe
  instance-recipe-egg

# Local development
develop +=
  ${:parts-directory}/cloudooo

[cloudooo-check-recipe]
recipe = plone.recipe.command
stop-on-error = true
update-command = ${:command}
command = grep parts ${buildout:develop-eggs-directory}/cloudooo.egg-link

[cloudooo]
recipe = plone.recipe.command
location = ${buildout:parts-directory}/${:_buildout_section_name_}
stop-on-error = true
repository = http://git.erp5.org/repos/cloudooo.git
branch = master
revision =
command = ${git:location}/bin/git clone --quiet -b ${:branch} ${:repository} ${:location} && if [ -n ${:revision} ]; then cd ${:location} && ${git:location}/bin/git reset --quiet --hard ${:revision} ; fi
update-command = cd ${:location} && ${git:location}/bin/git pull --quiet && if [ -n ${:revision} ]; then cd ${:location} && ${git:location}/bin/git reset --quiet --hard ${:revision} ; fi

[instance-recipe-egg]
recipe = zc.recipe.egg
python = python2.6
extra-paths = ${cloudooo:location}
eggs =
  ${lxml-python:egg}
  PasteScript
  python-magic
  psutil
  WSGIUtils
  cloudooo
entry-points =
  main=cloudooo.paster_application:application
  cloudooo_tester=cloudooo.bin.cloudooo_tester:main
  runCloudoooUnitTest=cloudooo.tests.runHandlerUnitTest:run
  runCloudoooTestSuite=cloudooo.tests.runTestSuite:run
scripts = 
  paster=cloudooo_paster
  runCloudoooUnitTest
  runCloudoooTestSuite
ugly-depend-on = ${cloudooo:command} ${cloudooo:update-command}

[bootstrap2.6]
python = python2.6

[rebootstrap]
# Default first version of rebootstrapped python
version = 3
section = python2.7

[versions]
# Use SlapOS patched zc.buildout
zc.buildout = 1.6.0-dev-SlapOS-003
