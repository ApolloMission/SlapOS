[buildout]
parts =
  libblas


[libblas]
recipe = cp.recipe.cmd
location = ${buildout:parts-directory}/${:_buildout_section_name_}
gfortran=${gcc-fortran:location}/bin/gfortran
install_cmd =
  set -e
  mkdir -p ${:location}__compile__
  cd ${:location}__compile__
  wget -nc http://www.netlib.org/blas/blas.tgz
  tar xzf blas.tgz
  cd BLAS
  ${:gfortran} -O3 -std=legacy -m64 -fno-second-underscore -fPIC -c *.f
  ar r libfblas.a *.o
  ranlib libfblas.a
  gcc -shared -Wl,-soname,libf77blas.so.3 -o libf77blas.so.3.0.0 *.o -lc
  # rm -rf *.o
  mkdir -p ${:location}
  mv libfblas.a ${:location}/
  cp libf77blas.so.3.0.0 ${:location}/
  cd ${:location}
  ln -sf libf77blas.so.3.0.0 libf77blas.so.3.0
  ln -sf libf77blas.so.3.0 libf77blas.so.3

#update_cmd = ${:install_cmd}

