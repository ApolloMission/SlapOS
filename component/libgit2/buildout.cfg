[buildout]
extends =
  ../cmake/buildout.cfg
  ../curl/buildout.cfg
  ../openssl/buildout.cfg
  ../pkgconfig/buildout.cfg
  ../zlib/buildout.cfg

[libgit2]
# The version here heavily depends on the version of 'rugged' gem that
# is used in gitlab.
recipe = slapos.recipe.cmmi
url = https://github.com/libgit2/libgit2/archive/v0.24.0.tar.gz
md5sum = 8cabf04502d7203793b32f47ca410ae3
location = ${buildout:parts-directory}/${:_buildout_section_name_}
configure-command = ${cmake:location}/bin/cmake
configure-options =
  -DCMAKE_INSTALL_PREFIX=${:location}
  -DCURL=1
  -DUSE_GSSAPI=0
  -DUSE_OPENSSL=1
  -DUSE_SSH=0
  -DCMAKE_INSTALL_RPATH=${curl:location}/lib:${openssl:location}/lib:${zlib:location}/lib
environment =
  CMAKE_INCLUDE_PATH=${curl:location}/include:${openssl:location}/include:${zlib:location}/include
  CMAKE_LIBRARY_PATH=${curl:location}/lib:${openssl:location}/lib:${zlib:location}/lib
  LDFLAGS=-L${curl:location}/lib
  PATH=${pkgconfig:location}/bin:%(PATH)s
  PKG_CONFIG_PATH=${curl:location}/lib/pkgconfig:${openssl:location}/lib/pkgconfig
