[buildout]

parts = busybox

[busybox-patch-download]
recipe = hexagonit.recipe.download
url = ${:_profile_base_location_}/${:filename}
md5sum = 292498db86c46e101bb14bf2c74c36f0
download-only = true
filename = busybox-1_20_2.patch

[busybox]
recipe = slapos.recipe.build
url = http://git.busybox.net/busybox/snapshot/busybox-1_20_2.tar.gz
md5sum = 025acebb48040ef62dd635d416d317e8
patches =
    ${busybox-patch-download:location}/${busybox-patch-download:filename}
script =
    extract_dir = self.extract(self.download(%(url)r, %(md5sum)r))
    workdir = guessworkdir(extract_dir)
    self.applyPatchList(self.options.get('patches'), '-p1', cwd=workdir)
    self.logger.info("Creating default configuration")
    call(['make', 'defconfig'], cwd=workdir, env=env)
    self.logger.info("Building")
    call(['make'], cwd=workdir, env=env)
    self.logger.info("Installing")
    call(['make', 'CONFIG_PREFIX=%(location)s', 'install'], cwd=workdir, env=env)
    self.logger.info("Installation finished")
