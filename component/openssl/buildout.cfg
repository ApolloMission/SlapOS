# OpenSSL - a toolkit implementing SSL v2/v3 and TLS v1 protocols as
#           well as a full-strength general purpose cryptography
#           library.
# http://www.openssl.org/

[buildout]
extends =
  ../ca-certificates/buildout.cfg
  ../zlib/buildout.cfg

parts =
  openssl

[openssl]
recipe = slapos.recipe.cmmi
dependencies =
  zlib
  ca-certificates
url = https://www.openssl.org/source/openssl-1.0.1c.tar.gz
md5sum = ae412727c8c15b67880aef7bd2999b2e
configure-command = ./config
configure-options =
  --prefix=%(prefix)s
  --openssldir=%(prefix)s/etc/ssl
  --libdir=lib
  shared no-idea no-mdc2 no-rc5 zlib
# it seems that parallel build sometimes fails for openssl.
make-options =
  -j1
post-install = rm -f %(prefix)s/etc/ssl/certs/* && for i in ${ca-certificates:prefix}/certs/*/*.crt; do ln -sv $i %(prefix)s/etc/ssl/certs/`%(prefix)s/bin/openssl x509 -hash -noout -in $i`.0; done; true

patches =
  ${:_profile_base_location_}/openssl-nodoc.patch#b4887a7b4e18402447bc6227d2493b92
  ${:_profile_base_location_}/openssl-exlibs.patch#dfb8979460d6d75f2d23d1ea83bbb40a

