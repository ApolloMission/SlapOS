########################################################
# Dropbear - a secure shell client and server for *nix #
#                                                      #
# http://matt.ucc.asn.au/dropbear/dropbear.html        #
########################################################

[buildout]
extends = 
  ../zlib/buildout.cfg

parts =
  dropbear

[dropbear]
recipe = slapos.recipe.cmmi
md5sum = 0284ea239083f04c8b874e08e1aca243
# XXX: We still use an old version of dropbear instead of the last one
#      in order have all patches working.
url = http://matt.ucc.asn.au/dropbear/releases/dropbear-0.53.1.tar.bz2

configure-options =
  --prefix=${buildout:parts-directory}/${:_buildout_section_name_}
  --with-zlib=${zlib:location}
  CFLAGS="-DENABLE_SINGLEUSER -D__DIRTY_NO_SHELL_CHECKING"

environment =
  CPPFLAGS =-I${zlib:location}/include
  LDFLAGS =-Wl,-rpath=${zlib:location}/lib -L${zlib:location}/lib

patches=
  ${:_profile_base_location_}/userspace.patch
  ${:_profile_base_location_}/ipv6-support.patch
  ${:_profile_base_location_}/no-shell-checking.patch
  ${:_profile_base_location_}/dropbear-0.53.1-static_build_fix.patch

patch-options=
  -p1

[x86-cygwin-dropbear]
patches = 
  ${dropbear:patches}
  ${:_profile_base_location_}/dropbear-0.53.1-cygwin.patch
