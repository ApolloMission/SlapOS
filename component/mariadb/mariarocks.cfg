[mariarocks-source]
recipe = slapos.recipe.build:gitclone
git-executable = ${git:location}/bin/git
repository = https://github.com/MariaDB/server.git
branch = bb-10.2-mariarocks

[mariadb]
url =
path = ${mariarocks-source:location}
patches =
pre-configure =
  ${:clean}
  ${git:location}/bin/git submodule update --init
  sed -i -e '/(rc == -1 || errno == EINTR)/s/||/\&\&/' libmariadb/plugins/pvio/pvio_socket.c
post-install +=
  ${:clean}
clean =
  ${git:location}/bin/git clean -Xdf
  ${git:location}/bin/git submodule foreach ${git:location}/bin/git clean -Xdf
  ${git:location}/bin/git -C libmariadb checkout plugins/pvio/pvio_socket.c
configure-options +=
  -DPLUGIN_DAEMON_EXAMPLE=NO
  -DPLUGIN_EXAMPLE=NO
  -DCMAKE_PROGRAM_PATH=${bison:location}/bin
