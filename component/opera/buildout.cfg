[buildout]
extends = 
  ../xorg/buildout.cfg
  ../fontconfig/buildout.cfg
  ../dbus/buildout.cfg
  ../gtk-2/buildout.cfg
  ../libpng/buildout.cfg

parts = 
  opera
  
[opera]
recipe = slapos.recipe.build
slapos_promise =
  file:opera

x86 = http://ftp.opera.com/pub/opera/linux/964/final/en/i386/static/opera-9.64.gcc295-static-qt3.i386.tar.bz2 b7952da582383e42c45bf13a97cdf7b6
x86-64 = todo 95b8f49090ff4390f517bfaa4a7f77c1

script =
  if not self.options.get('url'): self.options['url'], self.options['md5sum'] = self.options[guessPlatform()].split(' ')
  extract_dir = self.extract(self.download(self.options['url'], self.options.get('md5sum')))
  workdir = guessworkdir(extract_dir)
  self.copyTree(workdir, "%(location)s")
  wrapper_location = os.path.join("%(location)s", "opera-slapos")
  wrapper = open(wrapper_location, 'w')
  wrapper.write("""#!/bin/sh
  cd %(location)s
  export LD_LIBRARY_PATH=${libXrender:location}/lib/:${fontconfig:location}/lib/:${dbus:location}/lib/:${dbus-glib:location}/lib/:${pango:location}/lib:${cairo:location}/lib:${glib:location}/lib:${gtk-2:location}/lib:${atk:location}/lib:${gdk-pixbuf:location}/lib:${libXt:location}/lib:${libpng:location}/lib:${libSM:location}/lib:${libIce:location}/lib:%(location)s
  export PATH=${fontconfig:location}/bin:$PATH
  %(location)s/opera $*""")
  wrapper.close()
  profile_directory = os.path.join("%(location)s", "profile")
  os.mkdir(profile_directory)
  opera_config = open(os.path.join(profile_directory, "opera6.ini"), "w")
  opera_config.write("""[State]
  Reading Plugins=0
  Accept License=1
  Run=0""")
  opera_config.close()
  os.chmod(wrapper_location, 0766)

#[liberation-fonts]
#recipe = hexagonit.recipe.cmmi
#url = https://fedorahosted.org/releases/l/i/liberation-fonts/liberation-fonts-ttf-1.07.0.tar.gz