[buildout]
extends = 
  ../bison/buildout.cfg
  ../dbus/buildout.cfg
  ../flex/buildout.cfg
  ../gtk-2/buildout.cfg
  ../glib/buildout.cfg
  ../mesa/buildout.cfg
  ../perl/buildout.cfg
   
parts =
  firefox-bin
  firefox

[firefox-bin]
recipe = slapos.recipe.build
slapos_promise =
  file:firefox
  file:firefox-bin
  file:firefox-wrapper

x86 = http://releases.mozilla.org/pub/mozilla.org/firefox/releases/6.0.2/linux-i686/en-US/firefox-6.0.2.tar.bz2 d3334d1c4f7c94d0ec2b2d76f6d720d0
x86-64 = http://releases.mozilla.org/pub/mozilla.org/firefox/releases/6.0.2/linux-x86_64/en-US/firefox-6.0.2.tar.bz2 13df923c0fbc40da0af4d3147da8ec2f
script =
  if not self.options.get('url'): self.options['url'], self.options['md5sum'] = self.options[guessPlatform()].split(' ')
  extract_dir = self.extract(self.download(self.options['url'], self.options.get('md5sum')))
  workdir = guessworkdir(extract_dir)
  self.copyTree(workdir, "%(location)s")
  wrapper = open(os.path.join("%(location)s", "firefox-wrapper"), 'w')
  wrapper.write("""#!/bin/sh
  export LD_LIBRARY_PATH=${libXrender:location}/lib/:${fontconfig:location}/lib/:${dbus:location}/lib/:${pango:location}/lib:${cairo:location}/lib:${glib:location}/lib:${gtk-2:location}/lib:${atk:location}/lib:${gdk-pixbuf:location}/lib:${libXt:location}/lib:${gtk-2:location}/lib:%(location)s
  %(location)s/firefox""")

[libIDL]
recipe = hexagonit.recipe.cmmi
url = http://ftp.gnome.org/pub/gnome/sources/libIDL/0.8/libIDL-0.8.14.tar.bz2
#md5sum = 
environment =
  PKG_CONFIG_PATH=${bison:location}/lib/pkgconfig:${glib:location}/lib/pkgconfig:${pango:location}/lib/pkgconfig
  LD_LIBRARY_PATH=${bison:location}/lib:${glib:location}/lib
  LD_RUN_PATH=${bison:location}/lib:${glib:location}/lib
  PATH=${pkgconfig:location}/bin:${bison:location}/bin::${flex:location}/bin:%(PATH)s

[firefox-cairo-patch]
recipe = hexagonit.recipe.download
url = http://svnweb.mageia.org/packages/cauldron/xulrunner/current/SOURCES/xulrunner-2.0-system-cairo.patch?revision=43415&view=co&pathrev=60536
download-only = true
filename = cairo.patch

[firefox]
recipe = hexagonit.recipe.cmmi
url = ftp://ftp.mozilla.org/pub/mozilla.org/firefox/releases/6.0.2/source/firefox-6.0.2.source.tar.bz2
#patches =
#  ${firefox-cairo-patch:location}/${firefox-cairo-patch:filename}
configure-options = 
  --enable-system-cairo
  --disable-webm
  --disable-ogg
  --disable-wave
  --disable-gnomevfs
  --disable-gconf
  --disable-libnotify
  --disable-gnomeui
  --disable-accessibility
  --disable-printing
  --disable-crashreporter
  --disable-libjpeg-turbo
  --disable-updater
  --disable-javaxpcom
  --disable-necko-disk-cache
  --disable-necko-wifi
  --disable-angle
  --disable-tests
environment =
  PATH=${pkgconfig:location}/bin:${glib:location}/bin:%(PATH)s
  PKG_CONFIG_PATH=${gtk-2:location}/lib/pkgconfig:${glib:location}/lib/pkgconfig:${pango:location}/lib/pkgconfig:${cairo:location}/lib/pkgconfig:${freetype:location}/lib/pkgconfig:${fontconfig:location}/lib/pkgconfig:${pixman:location}/lib/pkgconfig:${libpng:location}/lib/pkgconfig:${libIDL:location}/lib/pkgconfig:${libXt:location}/lib/pkgconfig:${dbus:location}/lib/pkgconfig:${dbus-glib:location}/lib/pkgconfig:${mesa:location}/lib/pkgconfig:${libXrender:location}/lib/pkgconfig:${libX11:location}/lib/pkgconfig:${xproto:location}/lib/pkgconfig:${kbproto:location}/lib/pkgconfig:${libxcb:location}/lib/pkgconfig:${libXext:location}/lib/pkgconfig:${xextproto:location}/lib/pkgconfig:${gdk-pixbuf:location}/lib/pkgconfig:${xorg-libpthread-stubs:location}/lib/pkgconfig:${atk:location}/lib/pkgconfig:${libXau:location}/lib/pkgconfig
  CPPFLAGS=-I${libX11:location}/include -I${xproto:location}/include -I${libXt:location}/include -I${libXext:location}/include -I${xextproto:location}/include -I${libXrender:location}/include -I${render:location}/include -I${mesa:location}/include -I${libIce:location}/include -I${kbproto:location}/include -I${xtrans:location}/include -I${fontconfig:location}/include/ -I${freetype:location}/include/ -I${freetype:location}/include/freetype2 -I${cairo:location}/include/cairo -I${libSM:location}/include/ -I${xorg-libpthread-stubs:location}/include -I${pango:location}/include/pango-1.0 -I${gdk-pixbuf:location}/include/gdk-pixbuf-2.0 -I${glib:location}/include/glib-2.0 -I${glib:location}/include/gio-unix-2.0 -I${glib:location}/lib/glib-2.0/include -I${gtk-2:location}/include/gtk-2.0 -I${gtk-2:location}/lib/gtk-2.0/include -I${atk:location}/include/atk-1.0 -I${libdrm:location}/include/libdrm -I${libdrm:location}/include -I${dbus-glib:location}/include
  LDFLAGS=-L${gettext:location}/lib -L${libX11:location}/lib -L${xproto:location}/lib -L${libXt:location}/lib -L${libXext:location}/lib -L${xextproto:location}/lib -L${libXrender:location}/lib -L${render:location}/lib -L${mesa:location}/lib -L${libIce:location}/lib -L${kbproto:location}/lib -L${xtrans:location}/lib -L${fontconfig:location}/lib/ -L${freetype:location}/lib/ -L${freetype:location}/lib/freetype2 -L${cairo:location}/lib/cairo -L${libSM:location}/lib/ -L${xorg-libpthread-stubs:location}/lib -L${pango:location}/lib/pango-1.0 -L${gdk-pixbuf:location}/lib/gdk-pixbuf-2.0 -L${glib:location}/lib/glib-2.0 -L${glib:location}/lib/gio-unix-2.0 -L${glib:location}/lib/glib-2.0/lib -L${gtk-2:location}/lib/gtk-2.0 -L${gtk-2:location}/lib/gtk-2.0/lib -L${atk:location}/lib/atk-1.0 -L${libdrm:location}/lib/libdrm -L${libdrm:location}/lib -L${dbus-glib:location}/lib -lX11
  LD_LIBRARY_PATH=${libIDL:location}/lib:${glib:location}/lib:${gettext:location}/lib:${gtk-2:location}/lib:${cairo:location}/lib:${pango:location}/lib:${libpng:location}/lib:${freetype:location}/lib:${fontconfig:location}/lib:${pixman:location}/lib:${libXt:location}/lib:${dbus:location}/lib:${mesa:location}/lib
