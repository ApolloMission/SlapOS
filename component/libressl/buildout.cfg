# LibreSSL is a version of the TLS/crypto stack forked from OpenSSL in
# 2014, with goals of modernizing the codebase, improving security,
# and applying best practice development processes.
# http://www.libressl.org/

[buildout]
extends =
  ../ca-certificates/buildout.cfg
  ../coreutils/buildout.cfg

parts =
  openssl-output

[libressl]
recipe = slapos.recipe.cmmi
url = http://ftp.openbsd.org/pub/OpenBSD/LibreSSL/libressl-2.2.3.tar.gz
md5sum = 9a3c3c9a1c0bd6fb2659ca003de3f725
configure-options =
  --disable-static
post-install =
  rm -f ${buildout:parts-directory}/${:_buildout_section_name_}/etc/ssl/certs/* && for i in ${ca-certificates:location}/certs/*/*.crt; do ln -sv $i ${buildout:parts-directory}/${:_buildout_section_name_}/etc/ssl/certs/`${buildout:parts-directory}/${:_buildout_section_name_}/bin/openssl x509 -hash -noout -in $i`.0; done

[openssl-output]
# Shared binary location to ease migration
recipe = plone.recipe.command
stop-on-error = true
update-command = ${:command}
command = ${coreutils-output:test} -x ${:openssl}
openssl = ${libressl:location}/bin/openssl
