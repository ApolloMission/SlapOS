[buildout]
extends =
  ../../stack/shacache-client.cfg
  ../bison/buildout.cfg
  ../bzip2/buildout.cfg
  ../gdbm/buildout.cfg
  ../gettext/buildout.cfg
  ../glib/buildout.cfg
  ../libxml2/buildout.cfg
  ../libxslt/buildout.cfg
  ../lxml-python/buildout.cfg
  ../m2crypto/buildout.cfg
  ../m4/buildout.cfg
  ../ncurses/buildout.cfg
  ../openssl/buildout.cfg
  ../pkgconfig/buildout.cfg
  ../popt/buildout.cfg
  ../python-2.7/buildout.cfg
  ../readline/buildout.cfg
  ../sqlite3/buildout.cfg
  ../swig/buildout.cfg
  ../zlib/buildout.cfg

parts =
  slapos
  environment

find-links =
  http://www.nexedi.org/static/packages/source/slapos.buildout/

versions = versions

allow-hosts =
  *.googlecode.com
  *.nexedi.org
  *.python.org
  alastairs-place.net
  code.google.com
  github.com
  peak.telecommunity.com

# separate from system python
include-site-packages = false
exec-sitecustomize = false
allowed-eggs-from-site-packages =

[environment]
# Section exposes SlapOS default environment.
# Note: For now original PATH is appeneded to the end, as not all tools are
#       provided by SlapOS
recipe = plone.recipe.command
PATH=${bison:location}/bin:${bzip2:location}/bin:${gettext:location}/bin:${glib:location}/bin:${libxml2:location}/bin:${libxslt:location}/bin:${m4:location}/bin:${ncurses:location}/bin:${openssl:location}/bin:${pkgconfig:location}/bin:${python2.7:location}/bin:${readline:location}/bin:${sqlite3:location}/bin:${swig:location}/bin:${buildout:bin-directory}:$PATH

CFLAGS=-I${bzip2:location}/include -I${gdbm:location}/include -I${gettext:location}/include -I${glib:location}/include -I${libxml2:location}/include -I${libxslt:location}/include -I${ncurses:location}/include -I${openssl:location}/include -I${popt:location}/include -I${readline:location}/include -I${sqlite3:location}/include -I${zlib:location}/include
CPPFLAGS=${:CFLAGS}
LDFLAGS=-L${bzip2:location}/lib -Wl,-rpath=${bzip2:location}/lib -L${gdbm:location}/lib -Wl,-rpath=${gdbm:location}/lib -L${gettext:location}/lib -Wl,-rpath=${gettext:location}/lib -L${glib:location}/lib -Wl,-rpath=${glib:location}/lib -L${libxml2:location}/lib -Wl,-rpath=${libxml2:location}/lib -L${libxslt:location}/lib -Wl,-rpath=${libxslt:location}/lib -L${ncurses:location}/lib -Wl,-rpath=${ncurses:location}/lib -L${openssl:location}/lib -Wl,-rpath=${openssl:location}/lib -L${popt:location}/lib -Wl,-rpath=${popt:location}/lib -L${readline:location}/lib -Wl,-rpath=${readline:location}/lib -L${sqlite3:location}/lib -Wl,-rpath=${sqlite3:location}/lib -L${zlib:location}/lib -Wl,-rpath=${zlib:location}/lib
PKG_CONFIG_PATH=${glib:location}/lib/pkgconfig:${libxml2:location}/lib/pkgconfig:${libxslt:location}/lib/pkgconfig:${openssl:location}/lib/pkgconfig:${popt:location}/lib/pkgconfig:${python2.7:location}/lib/pkconfig:${sqlite3:location}/lib/pkconfig
command = echo """[environment]
  PATH=${:PATH}
  CFLAGS=${:CFLAGS}
  CPPFLAGS=${:CPPFLAGS}
  LDFLAGS=${:LDFLAGS}
  PKG_CONFIG_PATH=${:PKG_CONFIG_PATH}
  """ > ${buildout:directory}/environment.cfg
update-commnad = ${:command}

[lxml-python]
python = python2.7

[M2Crypto]
python = python2.7

[slapos]
recipe = z3c.recipe.scripts
python = python2.7
eggs =
  ${M2Crypto:egg}
  slapos.libnetworkcache
  zc.buildout
  ${lxml-python:egg}
  slapos.core

# control scripts generation in order to avoid reinstalling bin/buildout
scripts =
  generate-signature-key = slapos.signature:run
  slapconsole = slapos.console:run
  slapos-request = slapos.console:request
  slapformat = slapos.format:main
  slapgrid = slapos.grid.slapgrid:run
  slapgrid-sr = slapos.grid.slapgrid:runSoftwareRelease
  slapgrid-cp = slapos.grid.slapgrid:runComputerPartition
  slapgrid-ur = slapos.grid.slapgrid:runUsageReport
  slapgrid-supervisorctl = slapos.grid.svcbackend:supervisorctl
  slapgrid-supervisord = slapos.grid.svcbackend:supervisord
  slapproxy = slapos.proxy:main

[versions]
zc.buildout = 1.5.3-dev-SlapOS-008
