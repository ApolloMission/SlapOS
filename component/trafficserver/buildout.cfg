[buildout]
extends =
  ../../component/lua/buildout.cfg
  ../../component/hwloc/buildout.cfg
  ../../component/pkgconfig/buildout.cfg
  ../../component/libtool/buildout.cfg
  ../../component/make/buildout.cfg
  ../../component/openssl/buildout.cfg
  ../../component/tcl/buildout.cfg
  ../../component/libexpat/buildout.cfg
  ../../component/pcre/buildout.cfg
  ../../component/libcap/buildout.cfg
  ../../component/flex/buildout.cfg
  ../../component/ncurses/buildout.cfg
  ../../component/curl/buildout.cfg
  ../../component/zlib/buildout.cfg

parts =
  trafficserver

[trafficserver]
recipe = slapos.recipe.cmmi
url = http://apache.claz.org/trafficserver/trafficserver-4.2.1.tar.bz2
md5sum = 18f7d56650cba260c8cce3bf4abfa56c
configure-options =
  --prefix=${buildout:parts-directory}/${:_buildout_section_name_}
  --with-openssl=${openssl:location}
  --with-expat=${libexpat:location}
  --with-pcre=${pcre:location}
  --with-lua=${lua:location}
  --with-ncurses=${ncurses:location}
  --with-tcl=${tcl:location}/lib/
  --with-zlib=${zlib:location}
  --enable-experimental-plugins
environment =
  PATH=${make:location}/bin:${libtool:location}/bin:${pkgconfig:location}/bin:%(PATH)s
  LDFLAGS = -L${tcl:location}/lib -Wl,-rpath=${tcl:location}/lib -Wl,-rpath=${openssl:location}/lib
make-target =
  check
  install
