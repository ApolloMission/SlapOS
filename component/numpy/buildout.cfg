[buildout]

extends =
  ../git/buildout.cfg
  ../gcc/buildout.cfg
  ../libatlas/buildout.cfg
  ../libblas/buildout.cfg


[scipy-repository.git]
recipe = slapos.recipe.build:gitclone
repository = https://github.com/mmariani/scipy.git
branch = hardcoded-numpy-location
git-executable = ${git:location}/bin/git

[scikit-learn-repository.git]
recipe = slapos.recipe.build:gitclone
repository = https://github.com/scikit-learn/scikit-learn.git
branch = master
git-executable = ${git:location}/bin/git


[build-venv]
dependency = ${prerequired-eggs:recipe}
recipe = cp.recipe.cmd
location = ${buildout:parts-directory}/${:_buildout_section_name_}
install_cmd =
  if [ -d ${:location} ]; then
    exit
  fi
  mkdir -p ${:location}
  cd ${:location}
  unset PYTHONPATH
  export PATH="${gcc-fortran:location}/bin:$PATH"
  export LD_PRELOAD="${gcc-fortran:location}/lib64/libgfortran.so.3 ${libblas:location}/libf77blas.so.3"
  export ATLAS=${libatlas:location}/lib/libsatlas.so
  export BLAS=${libblas:location}/lib/libfblas.a
  export LAPACK=${libatlas:location}/lib/liblapack.a
  ${python2.7-virtualenv:executable} ${:location}
  . ${:location}/bin/activate
  ${:location}/bin/pip install numpy
  ${:location}/bin/pip install Tempita
  export PYTHONPATH=${buildout:eggs-directory}/numpy-1.8.1-py2.7-linux-x86_64.egg
  cd ${scipy-repository.git:location}
  python setupegg.py bdist_egg
  cd ${scikit-learn-repository.git:location}
  python setup.py bdist_egg
update_cmd = ${:install_cmd}


[prerequired-eggs]
recipe = zc.recipe.egg
eggs =
  slapos.cookbook
  numpy


[numpy-eggs]
dependencies = ${build-venv:recipe}
recipe = zc.recipe.egg
find-links =
    ${scipy-repository.git:location}/dist
    ${scikit-learn-repository.git:location}/dist
eggs =
  numpy
  scipy
  scikit-learn
interpreter = python-numpy


[versions]
cp.recipe.cmd = 0.5nxd001
numpy = 1.8.1
scipy = 0.13.3001
scikit-learn = 0.16-git

