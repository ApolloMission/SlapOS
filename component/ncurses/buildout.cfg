[buildout]
parts =
  ncurses

[ncurses]
recipe = slapos.recipe.cmmi
url = ftp://ftp.gnu.org/pub/gnu/ncurses/ncurses-5.9.tar.gz
md5sum = 8cb9c412e5f2d96bc6f459aa8c6282a1
configure-options =
  --with-shared
  --without-normal
  --without-debug
  --without-gpm
  --enable-rpath

# tricky way to rerun with --enable-widec
make-targets = install && (for i in curses unctrl eti form menu panel term; do ln -sf ncurses/$i.h ${buildout:parts-directory}/${:_buildout_section_name_}/include/$i.h; done; ln -sf libncurses.so ${buildout:parts-directory}/${:_buildout_section_name_}/lib/libcurses.so) && ./configure ${:configure-options} --enable-widec && make ${:make-options} install
make-options =
  -j1

[x86-cygwin-ncurses]
configure-options =
  ${ncurses:configure-options}
  --with-libtool

make-targets = install && (for i in curses unctrl eti form menu panel term; do ln -sf ncurses/$i.h %(prefix)s/include/$i.h; done; ln -sf libncurses.dll.a %(prefix)s/lib/libcurses.dll.a) && CFLAGS="" CPPFLAGS="" CXXFLAGS="" ./configure --prefix=%(prefix)s ${ncurses:configure-options} --enable-widec && make install

[no-environment]
# pass dummy LDCONFIG to skip needless calling of ldconfig by non-root user
environment =
  LDCONFIG=/bin/echo
